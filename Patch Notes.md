# Patch Note: 2025-08-20
## 요약
- `GEMINI.md`의 요구사항에 따라 경북대학교 체육관 예약 자동화 Python 스크립트를 신규 작성함.
- `selenium`을 사용하여 웹 브라우저를 자동화하고, 지정된 시간에 예약 프로세스를 수행하도록 구현함.

## 주요 문제점 및 해결 과정
- **문제점**: 웹사이트의 예약 과정은 여러 페이지에 걸쳐 있으며, JavaScript를 통해 동적으로 요소가 변경됨.
- **해결 과정**:
  1.  `selenium` 라이브러리를 채택하여 실제 사용자와 같이 브라우저를 조작하도록 함.
  2.  로그인, 예약 페이지 직접 접근, 시간 선택, 세부 정보 입력 등 각 단계를 순차적으로 함수로 구현함.
  3.  `WebDriverWait`을 사용하여 페이지 로딩 및 동적 컨텐츠 생성을 안정적으로 기다리도록 처리함.
  4.  사용자가 쉽게 정보를 변경할 수 있도록 스크립트 상단에 `USER_CONFIG` 딕셔너리를 두어 설정값을 분리함.

## 최종 해결책
- `knu_gym_reserver.py` 스크립트를 작성하여 전체 예약 과정을 자동화함.
- 스크립트는 다음의 기능을 포함함:
  - 설정 파일(`USER_CONFIG`) 기반 사용자 정보 관리
  - 자동 로그인
  - 지정된 시간에 예약 페이지로 이동
  - 예약 양식 자동 채우기 및 제출
  - 실행 전, 입력값 유효성 검사 (문자열 길이, ID/PW 설정 여부)

## 결과
- 사용자는 `USER_CONFIG`에 자신의 정보만 입력하고 스크립트를 실행하면, 지정된 시간에 자동으로 예약이 진행됨.
- 프로그램 실행을 위해 `selenium` 라이브러리 설치가 필요함 (`pip install selenium`).

---

# Patch Note: 2025-08-21
## 요약
- `chromedriver.exe` 경로 탐색 로직을 수정하여 `NoSuchDriverException` 오류를 해결함.

## 주요 문제점 및 해결 과정
- **문제점**: 스크립트 실행 위치에 따라 `chromedriver.exe`를 찾지 못하는 문제가 발생함 (`selenium.common.exceptions.NoSuchDriverException`). 기존 코드는 `os.getcwd()`를 사용하여 현재 작업 디렉토리에서 드라이버를 찾으려고 시도했으나, 이는 스크립트의 실제 위치와 다를 수 있음.
- **해결 과정**:
  1. `os.path.realpath(__file__)`를 사용하여 현재 실행 중인 스크립트의 절대 경로를 얻음.
  2. `os.path.dirname()`을 사용하여 스크립트가 위치한 디렉토리를 확인함.
  3. `os.path.join()`을 사용하여 스크립트 디렉토리와 `chromedriver.exe` 파일명을 결합하여 드라이버의 정확한 경로를 생성함.
  4. 수정된 경로를 `selenium.webdriver.chrome.service.Service`에 전달하여 `webdriver.Chrome`을 초기화하도록 코드를 변경함.

## 최종 해결책
- `knu_gym_reserver.py`의 `reserve_facility` 함수 내에서 `webdriver.Chrome`을 초기화하는 부분을 수정하여, 현재 작업 디렉토리(CWD) 대신 스크립트 파일의 위치를 기준으로 `chromedriver.exe`의 경로를 설정하도록 변경함.

## 결과
- 스크립트가 어떤 위치에서 실행되더라도, 스크립트와 동일한 폴더에 `chromedriver.exe`가 있다면 항상 정확한 경로를 찾아 웹 드라이버를 성공적으로 시작할 수 있게 됨.

---

# Patch Note: 2025-08-21 (2)
## 요약
- 예약 시간 선택 시 발생하는 `InvalidSelectorException` 오류를 해결함.

## 주요 문제점 및 해결 과정
- **문제점**: Selenium이 시간 선택 버튼을 클릭하기 위해 사용하는 XPath 표현식이 잘못되어 `InvalidSelectorException` 오류가 발생함. XPath 문자열 내부에 작은따옴표(')가 부적절하게 중첩되어 있었음.
- **해결 과정**:
  1. 오류 로그를 분석하여 잘못된 XPath 표현식 (`//a[@onclick='reserveFacility('9')']`)을 식별함.
  2. 웹사이트의 HTML 소스를 확인하여 올바른 `onclick` 속성 형식이 `onclick="reserveFacility('9')"`임을 확인함.
  3. `knu_gym_reserver.py`에서 XPath를 생성하는 Python 코드를 수정하여, 외부에는 큰따옴표(")를, 내부에는 작은따옴표(')를 사용하도록 변경함 (`//a[@onclick="reserveFacility('9')"]`).

## 최종 해결책
- `knu_gym_reserver.py`의 `reserve_facility` 함수 내에서 시간 선택 버튼의 XPath를 생성하는 로직을 수정하여, 유효한 XPath가 만들어지도록 함.

## 결과
- 스크립트가 예약 시간을 정상적으로 선택하고 다음 단계로 진행할 수 있게 됨.

---

# Patch Note: 2025-08-21 (3)
## 요약
- 예약 프로세스 중 발생하는 '가짜 성공' 문제를 해결하고, 디버깅을 위해 스크립트 실행 후 브라우저가 자동으로 닫히지 않도록 수정함.

## 주요 문제점 및 해결 과정
- **문제점**: 스크립트가 "예약신청을 하시겠습니까?" 라는 확인(confirm) 알림창을 최종 성공 메시지로 잘못 인식하여, 실제 예약이 완료되지 않았음에도 성공으로 처리하고 종료하는 문제가 있었음.
- **해결 과정**:
  1.  기존의 단일 알림창 처리 로직을 2단계로 수정함.
      - 첫 번째 알림창("예약신청을 하시겠습니까?")이 나타나면, 이를 확인하고 `alert.accept()`를 호출함.
      - 그 후, 실제 예약 완료를 알리는 두 번째 알림창을 기다리도록 `WebDriverWait`을 추가함.
  2.  두 번째 알림창을 기다리는 동안 발생할 수 있는 예외(timeout 등)를 처리하기 위해 `try...except` 블록을 추가하여 안정성을 높임.
  3.  문제 분석을 용이하게 하기 위해, `finally` 블록에 있는 `driver.quit()` 코드를 주석 처리하여 스크립트 완료 후에도 사용자가 브라우저 상태를 직접 확인할 수 있도록 함.

## 최종 해결책
- `knu_gym_reserver.py`의 알림창 처리 로직을 수정하여, 확인창과 최종 성공창을 구분하여 처리하도록 변경함.
- `finally` 블록의 `driver.quit()`을 주석 처리하여 브라우저가 열린 상태를 유지하도록 함.

## 결과
- 스크립트가 예약 확인창을 정상적으로 처리하고, 최종 예약 완료까지 대기할 수 있게 되어 예약 성공률이 높아짐.
- 스크립트 실행 후 브라우저가 유지되어, 예약 실패 시 원인 분석 및 수동 개입이 용이해짐.

---

# Patch Note: 2025-08-21 (4)
## 요약
- 기존의 CLI 기반 예약 스크립트를 GUI 애플리케이션으로 전환함.

## 주요 문제점 및 해결 과정
- **문제점**: 기존 스크립트는 `USER_CONFIG` 딕셔너리를 직접 수정해야 해서 사용 편의성이 떨어짐.
- **해결 과정**:
  1. Python 표준 라이브러리인 `tkinter`를 사용하여 GUI를 구현함.
  2. 모든 설정 값을 입력할 수 있는 `Entry` 위젯과 레이블을 배치함.
  3. '예약 실행', '초기화' 버튼을 추가하여 사용자 상호작용을 개선함.
  4. 실행 로그를 표시하는 `ScrolledText` 위젯을 추가하여 진행 상황을 시각적으로 확인할 수 있도록 함.
  5. Selenium 동작이 GUI를 차단하지 않도록 `threading`을 사용하여 예약 프로세스를 별도 스레드에서 실행하도록 구현함.

## 최종 해결책
- `knu_gym_reserver_gui.py` 파일을 새로 생성하여 GUI 애플리케이션을 구현함.
- GUI를 통해 사용자가 직접 예약 정보를 입력하고, 버튼 클릭으로 예약을 실행하거나 필드를 초기화할 수 있음.
- 기존의 `knu_gym_reserver.py`의 핵심 로직을 GUI 앱의 백엔드로 재사용함.

## 결과
- 사용자가 코드를 직접 수정할 필요 없이 그래픽 인터페이스를 통해 편리하게 예약 설정을 하고 프로그램을 실행할 수 있게 됨.
- 실행 과정과 결과가 GUI에 실시간으로 표시되어 사용 편의성이 크게 향상됨.

---

# Patch Note: 2025-08-21 (5)
## 요약
- GUI의 예약 실행 시간 설정을 개선하여 사용자 편의성을 높임.

## 주요 문제점 및 해결 과정
- **문제점**: 기존의 시간 입력 방식(HH:MM:SS)은 사용자가 직접 입력해야 하는 번거로움과 입력 오류의 가능성이 있었음.
- **해결 과정**:
  1. 기존의 텍스트 기반 시간 입력을 `Combobox` 위젯으로 변경함.
  2. 사용자는 '즉시', '오늘', '내일' 중 하나를 선택할 수 있음.
  3. '오늘' 또는 '내일'을 선택할 경우에만 시(hour)와 분(minute)을 선택하는 콤보박스가 활성화되도록 하여, 불필요한 입력을 최소화함.
  4. 선택된 옵션에 따라 프로그램이 내부적으로 대기 시간을 계산하도록 로직을 수정함.

## 최종 해결책
- `knu_gym_reserver_gui.py`의 예약 시간 설정 부분을 수정하여, 직관적인 UI(콤보박스)를 통해 예약 시간을 설정할 수 있도록 변경함.

## 결과
- 사용자가 더 빠르고 명확하게 예약 실행 시간을 설정할 수 있게 되었으며, 입력 오류 가능성이 줄어듦.

---

# Patch Note: 2025-08-21 (6)
## 요약
- 예약 실행 시점의 안정성을 높이기 위해 1초의 추가 대기 시간을 도입함.

## 주요 문제점 및 해결 과정
- **문제점**: 예약 정각에 정확히 맞춰 웹페이지에 접근하더라도, 서버의 예약 버튼이 활성화되는 데 미세한 지연이 발생할 수 있어 클릭 오류가 날 가능성이 있었음.
- **해결 과정**:
  1. `knu_gym_reserver_gui.py`의 `run_reservation` 함수 내에서, 지정된 예약 시간까지 대기하는 루프 바로 뒤에 `time.sleep(1)` 코드를 추가함.
  2. 이를 통해 예약 시간에 도달한 직후, 실제 웹페이지 조작을 시작하기 전에 1초의 여유를 두도록 함.

## 최종 해결책
- 예약 실행 로직에 1초의 대기 시간을 추가하여, 웹사이트의 예약 가능 상태가 확실히 활성화된 후 클릭을 시도하도록 수정함.

## 결과
- '타이밍' 문제로 인한 예약 실패 가능성을 줄여 프로그램의 안정성과 예약 성공률을 향상시킴.

---

# Patch Note: 2025-08-21 (7)
## 요약
- 사용자 요구사항을 반영하여 예약 로직을 "즉시 로그인, 지정 시간에 예약 실행"으로 변경하고 코드 구조를 개선함.

## 주요 문제점 및 해결 과정
- **문제점**: 이전 로직은 예약 시간에 로그인과 예약을 모두 수행하여, 정각의 서버 부하에 영향을 받을 수 있었음. 또한, 시간 대기 로직이 GUI 코드에 있어 역할 분리가 불명확했고, 코드 수정 과정에서 Pylance 오류가 발생하는 등 불안정했음.
- **해결 과정**:
  1.  **`knu_gym_reserver.py` 리팩토링**: 핵심 예약 로직을 `initialize_driver`, `login`, `reserve` 함수로 명확히 분리함. 시간 대기 로직을 `reserve` 함수 내부로 옮겨, 예약 URL에 접근하기 직전에만 대기하도록 책임 소재를 명확히 함.
  2.  **`knu_gym_reserver_gui.py` 수정 및 오류 해결**: `run_reservation` 함수에서 기존의 복잡한 Selenium 로직과 시간 대기 로직을 모두 제거. 대신, 리팩토링된 `reserver` 모듈의 함수들을 순차적으로 호출하는 방식으로 변경. 이 과정에서 발생했던 Pylance의 `reserver` 모듈 인식 불가 및 들여쓰기 오류를 해결하여 코드 안정성을 확보함.

## 최종 해결책
- **실행 시나리오 변경**: 사용자가 '예약 실행' 버튼을 누르면, 프로그램은 즉시 로그인하여 세션을 확보. 그 후, GUI에 지정된 예약 실행 시간이 될 때까지 대기했다가, 1초의 추가 지연 후 예약 페이지로 이동하여 나머지 작업을 수행하는 새롭고 안정적인 로직을 적용함.
- **코드 책임 분리**: 시간 대기라는 핵심 비즈니스 로직을 GUI 파일에서 핵심 기능 파일로 이전하여 코드의 역할과 책임을 명확히 분리함.

## 결과
- **예약 안정성 향상**: 예약 시간 전에 미리 로그인하므로, 트래픽이 몰리는 정각에는 예약 페이지 접근에만 집중할 수 있어 성공률이 높아짐.
- **사용자 경험 개선**: 버튼 클릭 시 즉시 로그인이 실행되고, GUI 로그를 통해 현재 대기 상태임을 명확하게 인지할 수 있게 됨.
- **유지보수성 향상**: 역할 분리가 명확해져 향후 로직 변경 및 기능 추가가 용이해짐.
