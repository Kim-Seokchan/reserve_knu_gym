# Patch Note: 2025-08-20
## 요약
- `GEMINI.md`의 요구사항에 따라 경북대학교 체육관 예약 자동화 Python 스크립트를 신규 작성함.
- `selenium`을 사용하여 웹 브라우저를 자동화하고, 지정된 시간에 예약 프로세스를 수행하도록 구현함.

## 주요 문제점 및 해결 과정
- **문제점**: 웹사이트의 예약 과정은 여러 페이지에 걸쳐 있으며, JavaScript를 통해 동적으로 요소가 변경됨.
- **해결 과정**:
  1.  `selenium` 라이브러리를 채택하여 실제 사용자와 같이 브라우저를 조작하도록 함.
  2.  로그인, 예약 페이지 직접 접근, 시간 선택, 세부 정보 입력 등 각 단계를 순차적으로 함수로 구현함.
  3.  `WebDriverWait`을 사용하여 페이지 로딩 및 동적 컨텐츠 생성을 안정적으로 기다리도록 처리함.
  4.  사용자가 쉽게 정보를 변경할 수 있도록 스크립트 상단에 `USER_CONFIG` 딕셔너리를 두어 설정값을 분리함.

## 최종 해결책
- `knu_gym_reserver.py` 스크립트를 작성하여 전체 예약 과정을 자동화함.
- 스크립트는 다음의 기능을 포함함:
  - 설정 파일(`USER_CONFIG`) 기반 사용자 정보 관리
  - 자동 로그인
  - 지정된 시간에 예약 페이지로 이동
  - 예약 양식 자동 채우기 및 제출
  - 실행 전, 입력값 유효성 검사 (문자열 길이, ID/PW 설정 여부)

## 결과
- 사용자는 `USER_CONFIG`에 자신의 정보만 입력하고 스크립트를 실행하면, 지정된 시간에 자동으로 예약이 진행됨.
- 프로그램 실행을 위해 `selenium` 라이브러리 설치가 필요함 (`pip install selenium`).

---

# Patch Note: 2025-08-21
## 요약
- `chromedriver.exe` 경로 탐색 로직을 수정하여 `NoSuchDriverException` 오류를 해결함.

## 주요 문제점 및 해결 과정
- **문제점**: 스크립트 실행 위치에 따라 `chromedriver.exe`를 찾지 못하는 문제가 발생함 (`selenium.common.exceptions.NoSuchDriverException`). 기존 코드는 `os.getcwd()`를 사용하여 현재 작업 디렉토리에서 드라이버를 찾으려고 시도했으나, 이는 스크립트의 실제 위치와 다를 수 있음.
- **해결 과정**:
  1. `os.path.realpath(__file__)`를 사용하여 현재 실행 중인 스크립트의 절대 경로를 얻음.
  2. `os.path.dirname()`을 사용하여 스크립트가 위치한 디렉토리를 확인함.
  3. `os.path.join()`을 사용하여 스크립트 디렉토리와 `chromedriver.exe` 파일명을 결합하여 드라이버의 정확한 경로를 생성함.
  4. 수정된 경로를 `selenium.webdriver.chrome.service.Service`에 전달하여 `webdriver.Chrome`을 초기화하도록 코드를 변경함.

## 최종 해결책
- `knu_gym_reserver.py`의 `reserve_facility` 함수 내에서 `webdriver.Chrome`을 초기화하는 부분을 수정하여, 현재 작업 디렉토리(CWD) 대신 스크립트 파일의 위치를 기준으로 `chromedriver.exe`의 경로를 설정하도록 변경함.

## 결과
- 스크립트가 어떤 위치에서 실행되더라도, 스크립트와 동일한 폴더에 `chromedriver.exe`가 있다면 항상 정확한 경로를 찾아 웹 드라이버를 성공적으로 시작할 수 있게 됨.

---

# Patch Note: 2025-08-21 (2)
## 요약
- 예약 시간 선택 시 발생하는 `InvalidSelectorException` 오류를 해결함.

## 주요 문제점 및 해결 과정
- **문제점**: Selenium이 시간 선택 버튼을 클릭하기 위해 사용하는 XPath 표현식이 잘못되어 `InvalidSelectorException` 오류가 발생함. XPath 문자열 내부에 작은따옴표(')가 부적절하게 중첩되어 있었음.
- **해결 과정**:
  1. 오류 로그를 분석하여 잘못된 XPath 표현식 (`//a[@onclick='reserveFacility('9')']`)을 식별함.
  2. 웹사이트의 HTML 소스를 확인하여 올바른 `onclick` 속성 형식이 `onclick="reserveFacility('9')"`임을 확인함.
  3. `knu_gym_reserver.py`에서 XPath를 생성하는 Python 코드를 수정하여, 외부에는 큰따옴표(")를, 내부에는 작은따옴표(')를 사용하도록 변경함 (`//a[@onclick="reserveFacility('9')"]`).

## 최종 해결책
- `knu_gym_reserver.py`의 `reserve_facility` 함수 내에서 시간 선택 버튼의 XPath를 생성하는 로직을 수정하여, 유효한 XPath가 만들어지도록 함.

## 결과
- 스크립트가 예약 시간을 정상적으로 선택하고 다음 단계로 진행할 수 있게 됨.

---

# Patch Note: 2025-08-21 (3)
## 요약
- 예약 프로세스 중 발생하는 '가짜 성공' 문제를 해결하고, 디버깅을 위해 스크립트 실행 후 브라우저가 자동으로 닫히지 않도록 수정함.

## 주요 문제점 및 해결 과정
- **문제점**: 스크립트가 "예약신청을 하시겠습니까?" 라는 확인(confirm) 알림창을 최종 성공 메시지로 잘못 인식하여, 실제 예약이 완료되지 않았음에도 성공으로 처리하고 종료하는 문제가 있었음.
- **해결 과정**:
  1.  기존의 단일 알림창 처리 로직을 2단계로 수정함.
      - 첫 번째 알림창("예약신청을 하시겠습니까?")이 나타나면, 이를 확인하고 `alert.accept()`를 호출함.
      - 그 후, 실제 예약 완료를 알리는 두 번째 알림창을 기다리도록 `WebDriverWait`을 추가함.
  2.  두 번째 알림창을 기다리는 동안 발생할 수 있는 예외(timeout 등)를 처리하기 위해 `try...except` 블록을 추가하여 안정성을 높임.
  3.  문제 분석을 용이하게 하기 위해, `finally` 블록에 있는 `driver.quit()` 코드를 주석 처리하여 스크립트 완료 후에도 사용자가 브라우저 상태를 직접 확인할 수 있도록 함.

## 최종 해결책
- `knu_gym_reserver.py`의 알림창 처리 로직을 수정하여, 확인창과 최종 성공창을 구분하여 처리하도록 변경함.
- `finally` 블록의 `driver.quit()`을 주석 처리하여 브라우저가 열린 상태를 유지하도록 함.

## 결과
- 스크립트가 예약 확인창을 정상적으로 처리하고, 최종 예약 완료까지 대기할 수 있게 되어 예약 성공률이 높아짐.
- 스크립트 실행 후 브라우저가 유지되어, 예약 실패 시 원인 분석 및 수동 개입이 용이해짐.
